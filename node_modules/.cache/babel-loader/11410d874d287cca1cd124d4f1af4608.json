{"ast":null,"code":"import _taggedTemplateLiteral from\"/Users/parkminkyung/Desktop/git/triport/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _toConsumableArray from\"/Users/parkminkyung/Desktop/git/triport/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/parkminkyung/Desktop/git/triport/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11,_templateObject12,_templateObject13,_templateObject14,_templateObject15,_templateObject16,_templateObject17,_templateObject18,_templateObject19,_templateObject20,_templateObject21,_templateObject22,_templateObject23;import React,{useEffect,useRef,useState,Fragment}from\"react\";import styled from\"styled-components\";import{HeartEmpty,HeartFill}from\"media/svg/Svg\";import{MODAL_STATUS}from\"redux/modules/trils\";import{useDispatch,useSelector}from\"react-redux\";import Hls from\"hls.js\";import ProgressBar from\"./ProgressBar\";import{TrilsActions,DELETE_POST,EDIT_POST}from\"redux/modules/trils\";import Swal from\"sweetalert2\";import ClearIcon from\"@material-ui/icons/Clear\";import{config}from\"../../redux/modules/config\";import uploading from\"../../media/image/uploading.png\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var TrilsDetail=function TrilsDetail(props){var history=props.history;var player=useRef(null);var players=useRef(null);var info=useSelector(function(state){return state.trils.detail;});var dispatch=useDispatch();var _useState=useState(0),_useState2=_slicedToArray(_useState,2),completed=_useState2[0],setCompleted=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),progress=_useState4[0],setProgress=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),editOn=_useState6[0],setEditOn=_useState6[1];var _useState7=useState(info.information.hashtag),_useState8=_slicedToArray(_useState7,2),tags=_useState8[0],setTags=_useState8[1];var tagInput=useRef(null);var _useState9=useState(true),_useState10=_slicedToArray(_useState9,2),mute=_useState10[0],setMute=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),tagType=_useState12[0],setTagType=_useState12[1];var removeTag=function removeTag(i){var newTags=_toConsumableArray(tags);newTags.splice(i,1);setTags(_toConsumableArray(newTags));};var InputKeyDown=function InputKeyDown(e){var val=e.target.value;if(e.key===\"Enter\"&&val||e.key===\",\"&&val||e.key===\" \"&&val){if(tags.length===3){alert(\"태그는 최대 3개까지 가능합니다.\");return;}if(tags.find(function(tag){return tag.toLowerCase()===val.toLowerCase();})){return;}setTagType(\"\");setTags([].concat(_toConsumableArray(tags),[val]));}else if(e.key===\"Backspace\"&&!val){removeTag(tags.length-1);}};var closeModal=function closeModal(){dispatch(MODAL_STATUS(false));};var params={src:info.information.videoUrl};useEffect(function(){var hls=new Hls();if(hls===undefined){return;}if(Hls.isSupported()){hls.attachMedia(player.current);hls.config.debug=false;hls.on(Hls.Events.MEDIA_ATTACHED,function(event,data){hls.loadSource(params.src);});hls.on(Hls.Events.ERROR,function(event,data){if(data.fatal){switch(data.type){case Hls.ErrorTypes.NETWORK_ERROR:console.log(\"네트워크 오류\");hls.startLoad();break;case Hls.ErrorTypes.MEDIA_ERROR:console.log(\"미디어 오류\");hls.recoverMediaError();break;default:hls.destroy();break;}}});return function(){return hls.destroy();};}else if(player.current.canPlayType(\"application/vnd.apple.mpegurl\")){player.current.src=params.src;player.current.addEventListener(\"loadedmetadata\",function(){player.current.play();});}},[params.src]);var m3u8volume=function m3u8volume(){if(player.current.readyState!==4){return;}if(!info.information.posPlay){return;}if(mute){setMute(false);}else{setMute(true);}};var mp4volume=function mp4volume(){if(players.current.readyState!==4){return;}if(!info.information.posPlay){return;}if(mute){setMute(false);}else{setMute(true);}};var like=function like(){var access_token=localStorage.getItem(\"access_token\");if(!access_token){Swal.fire({title:\"로그인을 해주세요.\",text:\"로그인 후 좋아요를 누를 수 있습니다.\",icon:\"warning\",showCancelButton:true,confirmButtonColor:\"#3085d6\",cancelButtonColor:\"#d33\",confirmButtonText:\"로그인하기\",cancelButtonText:\"닫기\"}).then(function(result){if(result.isConfirmed){history.push(\"/login\");}});}else{dispatch(TrilsActions.send_like(info.information.id,info.member.isLike));}};var del=function del(){Swal.fire({title:\"게시글을 삭제하시겠습니까?\",text:\"게시글 삭제 시 다시 복구할 수 없습니다.\",icon:\"warning\",showCancelButton:true,confirmButtonColor:\"#3085d6\",cancelButtonColor:\"#d33\",confirmButtonText:\"삭제\",cancelButtonText:\"취소\"}).then(function(result){if(result.isConfirmed){var access_token=localStorage.getItem(\"access_token\");var url=\"\".concat(config,\"/api/posts/\").concat(info.information.id);var data={method:\"DELETE\",headers:{Authorization:\"\".concat(access_token)}};fetch(url,data).then(function(result){return result.json();}).then(function(result){if(result.ok){dispatch(DELETE_POST(info.information.id));Swal.fire(\"삭제 완료!\",\"게시글이 삭제되었습니다.\",\"success\").then(function(){closeModal();});}}).catch(function(err){return console.log(err);});}});};var hash=function hash(e){history.push(\"/search?q=\".concat(e.target.id,\"&filter=likeNum\"),1);closeModal();};var edit=function edit(){setEditOn(true);};var cancelEdit=function cancelEdit(){setEditOn(false);};var doEdit=function doEdit(){var access_token=localStorage.getItem(\"access_token\");var url=\"\".concat(config,\"/api/posts/\").concat(info.information.id);var data={method:\"PUT\",headers:{\"Content-Type\":\"application/json\",Authorization:\"\".concat(access_token)},body:JSON.stringify({hashtag:tags})};fetch(url,data).then(function(result){return result.json();}).then(function(result){if(result.ok){var _data={id:info.information.id,hashtag:tags};dispatch(EDIT_POST(_data));setEditOn(false);}}).catch(function(err){return console.log(err);});};var change=function change(e){if(e.target.value.length>10){e.target.value=e.target.value.substr(0,10);}var curValue=e.target.value;var regExp=/[{}[\\]/?.,;:|)*~`!^\\-_+<>@#$%&\\\\=('\"\\s]/gi;// const regExp = /[\\{\\}\\[\\]\\/?.,;:|\\)*~`!^\\-_+<>@\\#$%&\\\\\\=\\(\\'\\\"\\s]/gi;\nvar newValue=curValue.replace(regExp,\"\");setTagType(newValue);};var hlsplay=function hlsplay(){if(player.current.readyState!==4){return;}player.current.play();};var hlspause=function hlspause(){if(player.current.readyState!==4){return;}player.current.pause();};var mp4play=function mp4play(){if(players.current.readyState!==4){return;}players.current.play();};var mp4pause=function mp4pause(){if(players.current.readyState!==4){return;}players.current.pause();};return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Component,{width:window.innerWidth,height:window.innerHeight,onClick:closeModal}),/*#__PURE__*/_jsxs(Wrap,{width:window.innerWidth,height:window.innerHeight,children:[/*#__PURE__*/_jsxs(Profile,{children:[/*#__PURE__*/_jsx(ProfileImg,{src:info.author.profileImgUrl}),/*#__PURE__*/_jsx(ProfileId,{children:info.author.nickname})]}),info.information.posPlay?/*#__PURE__*/_jsx(_Fragment,{children:info.information.videoType===\"mp4\"||info.information.videoType===\"mov\"?/*#__PURE__*/_jsx(View,{onMouseOver:mp4play,onMouseLeave:mp4pause,onClick:mp4volume,children:/*#__PURE__*/_jsx(VideoPlay,{ref:players,src:params.src,muted:mute,loop:true,autoPlay:true,onTimeUpdate:function onTimeUpdate(){setCompleted(players.current.currentTime/players.current.duration*100);setProgress(players.current.clientWidth);}})}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(View,{onMouseOver:hlsplay,onMouseLeave:hlspause,onClick:m3u8volume,children:/*#__PURE__*/_jsx(VideoPlay,{ref:player,muted:mute,loop:true,autoPlay:true,onTimeUpdate:function onTimeUpdate(){setCompleted(player.current.currentTime/player.current.duration*100);setProgress(player.current.clientWidth);}})})})}):/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(View,{children:/*#__PURE__*/_jsx(Uploading,{src:uploading})})}),/*#__PURE__*/_jsx(Progress,{width:progress,children:/*#__PURE__*/_jsx(ProgressBar,{bgcolor:\"#6a1b9a\",completed:completed})}),/*#__PURE__*/_jsxs(LowWrap,{children:[/*#__PURE__*/_jsx(LikeCov,{onClick:like,children:info.member.isLike?/*#__PURE__*/_jsx(HeartFill,{}):/*#__PURE__*/_jsx(HeartEmpty,{})}),/*#__PURE__*/_jsxs(LikeText,{children:[\"\\uC88B\\uC544\\uC694 +\",info.information.likeNum]}),/*#__PURE__*/_jsx(Tag,{children:editOn?/*#__PURE__*/_jsx(_Fragment,{children:tags.map(function(tag,i){return/*#__PURE__*/_jsxs(Li,{children:[\"#\",tag,/*#__PURE__*/_jsx(Libutton,{type:\"button\",onClick:function onClick(){removeTag(i);},children:/*#__PURE__*/_jsx(IconCover,{children:/*#__PURE__*/_jsx(ClearIcon,{})})})]},tag);})}):/*#__PURE__*/_jsx(_Fragment,{children:info.information.hashtag.map(function(p,idx){return/*#__PURE__*/_jsx(Fragment,{children:/*#__PURE__*/_jsxs(Hash,{id:p,onClick:hash,children:[\"#\",p]})},idx);})})})]}),editOn?/*#__PURE__*/_jsx(InputTag,{children:/*#__PURE__*/_jsx(Input,{type:\"text\",maxLength:10,value:tagType,onKeyDown:InputKeyDown,ref:tagInput,placeholder:\"# \\uC790\\uC720\\uB86D\\uAC8C \\uC801\\uACE0 \\uC5D4\\uD130\\uB97C \\uB20C\\uB7EC\\uC8FC\\uC138\\uC694.(10\\uC790 \\uC81C\\uD55C)\",onChange:change})}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsxs(Bottom,{children:[editOn?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Edit,{onClick:doEdit,children:\"\\uC218\\uC815\\uC644\\uB8CC\"}),/*#__PURE__*/_jsx(Delete,{onClick:cancelEdit,children:\"\\uC218\\uC815\\uCDE8\\uC18C\"})]}):/*#__PURE__*/_jsx(_Fragment,{children:info.member.isMembers?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Edit,{onClick:edit,children:\"\\uC218\\uC815\\uD558\\uAE30\"}),/*#__PURE__*/_jsx(Delete,{onClick:del,children:\"\\uC0AD\\uC81C\\uD558\\uAE30\"})]}):/*#__PURE__*/_jsx(_Fragment,{})}),/*#__PURE__*/_jsx(Close,{onClick:closeModal,children:\"\\uB2EB\\uAE30\"})]})]})]});};var LikeText=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  color: #8b8888;\\n  width: 5rem;\\n  user-select: none;\\n  display: flex;\\n  align-items: center;\\n\"])));var Uploading=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  display: flex;\\n  height: 20rem;\\n  width: 40rem;\\n  margin: 0 auto;\\n  background-image: url(\\\"\",\"\\\");\\n  background-size: contain;\\n  background-repeat: no-repeat;\\n  background-position: center;\\n\"])),function(props){return props.src;});var Input=styled.input(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  outline: none;\\n  width: 100%;\\n  height: 2.5rem;\\n  border: 0;\\n  border-radius: 5px;\\n  display: flex;\\n  justify-content: flex-start;\\n  /* margin: 0px auto; */\\n  padding-left: 0.5rem;\\n  padding-right: 0.5rem;\\n  font-size: 1rem;\\n\"])));var InputTag=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  min-width: 30rem;\\n  width: 100%;\\n  height: 100%;\\n  border: 1px solid #2b61e1;\\n  border-radius: 5px;\\n  display: inline-flex;\\n  flex-wrap: wrap;\\n  justify-content: flex-start;\\n  margin: 0px auto;\\n  padding: 5px;\\n  margin-bottom: 1rem;\\n\"])));var IconCover=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n  & svg {\\n    width: 1rem;\\n  }\\n\"])));var Libutton=styled.div(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  display: inline-flex;\\n  align-items: center;\\n  appearance: none;\\n  background: #333333;\\n  border: none;\\n  border-radius: 50%;\\n  color: white;\\n  cursor: pointer;\\n  font-size: 12px;\\n  height: 15px;\\n  justify-content: center;\\n  line-height: 0;\\n  margin-left: 8px;\\n  padding: 0;\\n  width: 15px;\\n  outline: 0;\\n\"])));var Li=styled.div(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  cursor: pointer;\\n  margin-left: 0.5rem;\\n  margin-right: 1rem;\\n  font-family: \\\"AppleSDGothicNeoR\\\";\\n  color: blue;\\n  display: flex;\\n  align-items: center;\\n\"])));var Bottom=styled.div(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  justify-content: flex-end;\\n\"])));var Edit=styled.button(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  cursor: pointer;\\n  font-family: \\\"paybooc-Bold\\\";\\n  font-size: 1rem;\\n  color: #ffffff;\\n  background-color: #2b61e1;\\n  box-shadow: 0px 3px 6px #00000029;\\n  border: 1px solid #2b61e1;\\n  border-radius: 5px;\\n  width: 8rem;\\n  height: 3rem;\\n\"])));var Delete=styled.button(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n  cursor: pointer;\\n  font-family: \\\"paybooc-Bold\\\";\\n  font-size: 1rem;\\n  color: #ffffff;\\n  background-color: #2b61e1;\\n  box-shadow: 0px 3px 6px #00000029;\\n  border: 1px solid #2b61e1;\\n  border-radius: 5px;\\n  width: 8rem;\\n  height: 3rem;\\n  margin-left: 1rem;\\n\"])));var Close=styled.button(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n  cursor: pointer;\\n  font-family: \\\"paybooc-Bold\\\";\\n  font-size: 1rem;\\n  color: #ffffff;\\n  background-color: #2b61e1;\\n  box-shadow: 0px 3px 6px #00000029;\\n  border: 1px solid #2b61e1;\\n  border-radius: 5px;\\n  width: 8rem;\\n  height: 3rem;\\n  margin-left: 1rem;\\n\"])));var Progress=styled.div(_templateObject12||(_templateObject12=_taggedTemplateLiteral([\"\\n  margin: 0 auto;\\n  width: \",\"px;\\n\"])),function(props){return props.width;});var VideoPlay=styled.video(_templateObject13||(_templateObject13=_taggedTemplateLiteral([\"\\n  display: flex;\\n  margin: 0 auto;\\n  max-width: 50rem;\\n  max-height: 30rem;\\n  object-fit: contain;\\n\\n  @media (max-width: 768px) {\\n    max-width: 35rem;\\n    max-height: 30rem;\\n  }\\n\\n  @media (max-width: 600px) {\\n  }\\n  @media (max-width: 540px) {\\n    width: 30rem;\\n    max-height: 50rem;\\n  }\\n  @media (max-width: 415px) {\\n  }\\n\"])));var Hash=styled.div(_templateObject14||(_templateObject14=_taggedTemplateLiteral([\"\\n  user-select: none;\\n  cursor: pointer;\\n  margin-left: 0.5rem;\\n  font-family: \\\"AppleSDGothicNeoR\\\";\\n  color: blue;\\n  transition: 0.5s ease-in-out;\\n  :hover {\\n    transform: scale(1.2);\\n  }\\n\"])));var Component=styled.div(_templateObject15||(_templateObject15=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  top: 0;\\n  left: 0;\\n  height: \",\"px;\\n  width: \",\"px;\\n  background-color: black;\\n  z-index: 60;\\n  opacity: 0.4;\\n\"])),function(props){return props.height;},function(props){return props.width;});var Wrap=styled.div(_templateObject16||(_templateObject16=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  top: 50%;\\n  left: 50%;\\n  transform: translate(-50%, -50%);\\n  z-index: 70;\\n  background-color: white;\\n  max-width: 57rem;\\n  max-height: 45rem;\\n  display: flex;\\n  flex-direction: column;\\n  margin: 0px auto;\\n  box-shadow: 0px 3px 6px #00000029;\\n  border: 1px solid #2b61e1;\\n  border-radius: 5px;\\n  padding: 3rem;\\n  z-index: 98;\\n\\n  @media (max-width: 768px) {\\n    max-width: 35rem;\\n    max-height: 30rem;\\n  }\\n\\n  @media (max-width: 600px) {\\n    max-width: 32rem;\\n    max-height: 30rem;\\n  }\\n  @media (max-width: 540px) {\\n    height: \",\"px;\\n    width: \",\"px;\\n    max-height: \",\"px;\\n    max-width: \",\"px;\\n  }\\n  @media (max-width: 415px) {\\n    height: \",\"px;\\n    width: \",\"px;\\n  }\\n\"])),function(props){return props.height;},function(props){return props.width;},function(props){return props.height;},function(props){return props.width;},function(props){return props.height;},function(props){return props.width;});var LowWrap=styled.div(_templateObject17||(_templateObject17=_taggedTemplateLiteral([\"\\n  display: flex;\\n  flex-direction: row;\\n  margin-left: 1rem;\\n  margin-top: 1rem;\\n  margin-bottom: 2rem;\\n\"])));var Profile=styled.div(_templateObject18||(_templateObject18=_taggedTemplateLiteral([\"\\n  display: flex;\\n  height: 3rem;\\n  align-items: center;\\n  margin-bottom: 1rem;\\n\"])));var ProfileImg=styled.div(_templateObject19||(_templateObject19=_taggedTemplateLiteral([\"\\n  --size: 38px;\\n  width: var(--size);\\n  height: var(--size);\\n  border-radius: var(--size);\\n  background-position: center;\\n  background-image: url(\",\");\\n  background-color: white;\\n  background-size: cover;\\n  margin-left: 16px;\\n  display: flex;\\n\"])),function(props){return props.src;});var ProfileId=styled.div(_templateObject20||(_templateObject20=_taggedTemplateLiteral([\"\\n  display: flex;\\n  font-weight: 600;\\n  font-size: 1rem;\\n  margin-left: 11px;\\n  align-items: center;\\n\"])));var View=styled.div(_templateObject21||(_templateObject21=_taggedTemplateLiteral([\"\\n  max-width: 50rem;\\n  max-height: 30rem;\\n  width: auto;\\n  height: auto;\\n  min-width: 40rem;\\n  min-height: 20rem;\\n  background-color: #ededed;\\n  /* background-color: #ededed; */\\n  display: flex;\\n  justify-content: center;\\n  margin: 0px auto;\\n\\n  @media (max-width: 768px) {\\n    max-width: 30rem;\\n    max-height: 30rem;\\n    min-width: 30rem;\\n  }\\n\\n  @media (max-width: 600px) {\\n    max-width: 28rem;\\n    max-height: 30rem;\\n    min-width: 28rem;\\n  }\\n  @media (max-width: 540px) {\\n    max-width: 18rem;\\n    max-height: 30rem;\\n    min-width: 18rem;\\n  }\\n  @media (max-width: 415px) {\\n  }\\n\"])));var LikeCov=styled.div(_templateObject22||(_templateObject22=_taggedTemplateLiteral([\"\\n  margin-right: 1rem;\\n  display: flex;\\n  align-items: center;\\n  cursor: pointer;\\n  z-index: 10;\\n  & svg {\\n    width: 1.5rem;\\n  }\\n\"])));var Tag=styled.div(_templateObject23||(_templateObject23=_taggedTemplateLiteral([\"\\n  font-weight: 700;\\n  margin-left: 1rem;\\n  display: flex;\\n  flex-direction: row;\\n  flex-wrap: wrap;\\n\"])));export default TrilsDetail;","map":{"version":3,"sources":["/Users/parkminkyung/Desktop/git/triport/src/components/trils/TrilsDetail.js"],"names":["React","useEffect","useRef","useState","Fragment","styled","HeartEmpty","HeartFill","MODAL_STATUS","useDispatch","useSelector","Hls","ProgressBar","TrilsActions","DELETE_POST","EDIT_POST","Swal","ClearIcon","config","uploading","TrilsDetail","props","history","player","players","info","state","trils","detail","dispatch","completed","setCompleted","progress","setProgress","editOn","setEditOn","information","hashtag","tags","setTags","tagInput","mute","setMute","tagType","setTagType","removeTag","i","newTags","splice","InputKeyDown","e","val","target","value","key","length","alert","find","tag","toLowerCase","closeModal","params","src","videoUrl","hls","undefined","isSupported","attachMedia","current","debug","on","Events","MEDIA_ATTACHED","event","data","loadSource","ERROR","fatal","type","ErrorTypes","NETWORK_ERROR","console","log","startLoad","MEDIA_ERROR","recoverMediaError","destroy","canPlayType","addEventListener","play","m3u8volume","readyState","posPlay","mp4volume","like","access_token","localStorage","getItem","fire","title","text","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","cancelButtonText","then","result","isConfirmed","push","send_like","id","member","isLike","del","url","method","headers","Authorization","fetch","json","ok","catch","err","hash","edit","cancelEdit","doEdit","body","JSON","stringify","change","substr","curValue","regExp","newValue","replace","hlsplay","hlspause","pause","mp4play","mp4pause","window","innerWidth","innerHeight","author","profileImgUrl","nickname","videoType","currentTime","duration","clientWidth","likeNum","map","p","idx","isMembers","LikeText","div","Uploading","Input","input","InputTag","IconCover","Libutton","Li","Bottom","Edit","button","Delete","Close","Progress","width","VideoPlay","video","Hash","Component","height","Wrap","LowWrap","Profile","ProfileImg","ProfileId","View","LikeCov","Tag"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState, Fragment } from \"react\";\nimport styled from \"styled-components\";\nimport { HeartEmpty, HeartFill } from \"media/svg/Svg\";\nimport { MODAL_STATUS } from \"redux/modules/trils\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport Hls from \"hls.js\";\nimport ProgressBar from \"./ProgressBar\";\nimport { TrilsActions, DELETE_POST, EDIT_POST } from \"redux/modules/trils\";\nimport Swal from \"sweetalert2\";\nimport ClearIcon from \"@material-ui/icons/Clear\";\nimport { config } from \"../../redux/modules/config\";\nimport uploading from \"../../media/image/uploading.png\";\n\nconst TrilsDetail = (props) => {\n  const { history } = props;\n  const player = useRef(null);\n  const players = useRef(null);\n  const info = useSelector((state) => state.trils.detail);\n  const dispatch = useDispatch();\n  const [completed, setCompleted] = useState(0);\n  const [progress, setProgress] = useState(0);\n  const [editOn, setEditOn] = useState(false);\n  const [tags, setTags] = useState(info.information.hashtag);\n  const tagInput = useRef(null);\n  const [mute, setMute] = useState(true);\n  const [tagType, setTagType] = useState(\"\");\n\n  const removeTag = (i) => {\n    const newTags = [...tags];\n    newTags.splice(i, 1);\n    setTags([...newTags]);\n  };\n\n  const InputKeyDown = (e) => {\n    const val = e.target.value;\n    if (\n      (e.key === \"Enter\" && val) ||\n      (e.key === \",\" && val) ||\n      (e.key === \" \" && val)\n    ) {\n      if (tags.length === 3) {\n        alert(\"태그는 최대 3개까지 가능합니다.\");\n        return;\n      }\n      if (tags.find((tag) => tag.toLowerCase() === val.toLowerCase())) {\n        return;\n      }\n      setTagType(\"\");\n      setTags([...tags, val]);\n    } else if (e.key === \"Backspace\" && !val) {\n      removeTag(tags.length - 1);\n    }\n  };\n\n  const closeModal = () => {\n    dispatch(MODAL_STATUS(false));\n  };\n\n  const params = {\n    src: info.information.videoUrl,\n  };\n\n  useEffect(() => {\n    const hls = new Hls();\n    if (hls === undefined) {\n      return;\n    }\n    if (Hls.isSupported()) {\n      hls.attachMedia(player.current);\n      hls.config.debug = false;\n\n      hls.on(Hls.Events.MEDIA_ATTACHED, (event, data) => {\n        hls.loadSource(params.src);\n      });\n      hls.on(Hls.Events.ERROR, (event, data) => {\n        if (data.fatal) {\n          switch (data.type) {\n            case Hls.ErrorTypes.NETWORK_ERROR:\n              console.log(\"네트워크 오류\");\n              hls.startLoad();\n              break;\n            case Hls.ErrorTypes.MEDIA_ERROR:\n              console.log(\"미디어 오류\");\n              hls.recoverMediaError();\n              break;\n            default:\n              hls.destroy();\n              break;\n          }\n        }\n      });\n\n      return () => hls.destroy();\n    } else if (player.current.canPlayType(\"application/vnd.apple.mpegurl\")) {\n      player.current.src = params.src;\n      player.current.addEventListener(\"loadedmetadata\", () => {\n        player.current.play();\n      });\n    }\n  }, [params.src]);\n\n  const m3u8volume = () => {\n    if (player.current.readyState !== 4) {\n      return;\n    }\n    if (!info.information.posPlay) {\n      return;\n    }\n    if (mute) {\n      setMute(false);\n    } else {\n      setMute(true);\n    }\n  };\n\n  const mp4volume = () => {\n    if (players.current.readyState !== 4) {\n      return;\n    }\n    if (!info.information.posPlay) {\n      return;\n    }\n    if (mute) {\n      setMute(false);\n    } else {\n      setMute(true);\n    }\n  };\n\n  const like = () => {\n    const access_token = localStorage.getItem(\"access_token\");\n    if (!access_token) {\n      Swal.fire({\n        title: \"로그인을 해주세요.\",\n        text: \"로그인 후 좋아요를 누를 수 있습니다.\",\n        icon: \"warning\",\n        showCancelButton: true,\n        confirmButtonColor: \"#3085d6\",\n        cancelButtonColor: \"#d33\",\n        confirmButtonText: \"로그인하기\",\n        cancelButtonText: \"닫기\",\n      }).then((result) => {\n        if (result.isConfirmed) {\n          history.push(\"/login\");\n        }\n      });\n    } else {\n      dispatch(TrilsActions.send_like(info.information.id, info.member.isLike));\n    }\n  };\n\n  const del = () => {\n    Swal.fire({\n      title: \"게시글을 삭제하시겠습니까?\",\n      text: \"게시글 삭제 시 다시 복구할 수 없습니다.\",\n      icon: \"warning\",\n      showCancelButton: true,\n      confirmButtonColor: \"#3085d6\",\n      cancelButtonColor: \"#d33\",\n      confirmButtonText: \"삭제\",\n      cancelButtonText: \"취소\",\n    }).then((result) => {\n      if (result.isConfirmed) {\n        const access_token = localStorage.getItem(\"access_token\");\n        const url = `${config}/api/posts/${info.information.id}`;\n        const data = {\n          method: \"DELETE\",\n          headers: {\n            Authorization: `${access_token}`,\n          },\n        };\n        fetch(url, data)\n          .then((result) => {\n            return result.json();\n          })\n          .then((result) => {\n            if (result.ok) {\n              dispatch(DELETE_POST(info.information.id));\n              Swal.fire(\n                \"삭제 완료!\",\n                \"게시글이 삭제되었습니다.\",\n                \"success\"\n              ).then(() => {\n                closeModal();\n              });\n            }\n          })\n          .catch((err) => console.log(err));\n      }\n    });\n  };\n\n  const hash = (e) => {\n    history.push(`/search?q=${e.target.id}&filter=likeNum`, 1);\n    closeModal();\n  };\n\n  const edit = () => {\n    setEditOn(true);\n  };\n\n  const cancelEdit = () => {\n    setEditOn(false);\n  };\n\n  const doEdit = () => {\n    const access_token = localStorage.getItem(\"access_token\");\n    const url = `${config}/api/posts/${info.information.id}`;\n    const data = {\n      method: \"PUT\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `${access_token}`,\n      },\n      body: JSON.stringify({\n        hashtag: tags,\n      }),\n    };\n    fetch(url, data)\n      .then((result) => {\n        return result.json();\n      })\n      .then((result) => {\n        if (result.ok) {\n          const data = {\n            id: info.information.id,\n            hashtag: tags,\n          };\n          dispatch(EDIT_POST(data));\n          setEditOn(false);\n        }\n      })\n      .catch((err) => console.log(err));\n  };\n\n  const change = (e) => {\n    if (e.target.value.length > 10) {\n      e.target.value = e.target.value.substr(0, 10);\n    }\n    const curValue = e.target.value;\n    const regExp = /[{}[\\]/?.,;:|)*~`!^\\-_+<>@#$%&\\\\=('\"\\s]/gi;\n    // const regExp = /[\\{\\}\\[\\]\\/?.,;:|\\)*~`!^\\-_+<>@\\#$%&\\\\\\=\\(\\'\\\"\\s]/gi;\n    const newValue = curValue.replace(regExp, \"\");\n    setTagType(newValue);\n  };\n\n  const hlsplay = () => {\n    if (player.current.readyState !== 4) {\n      return;\n    }\n    player.current.play();\n  };\n\n  const hlspause = () => {\n    if (player.current.readyState !== 4) {\n      return;\n    }\n    player.current.pause();\n  };\n\n  const mp4play = () => {\n    if (players.current.readyState !== 4) {\n      return;\n    }\n    players.current.play();\n  };\n\n  const mp4pause = () => {\n    if (players.current.readyState !== 4) {\n      return;\n    }\n    players.current.pause();\n  };\n\n  return (\n    <React.Fragment>\n      <Component\n        width={window.innerWidth}\n        height={window.innerHeight}\n        onClick={closeModal}\n      />\n      <Wrap width={window.innerWidth} height={window.innerHeight}>\n        <Profile>\n          <ProfileImg src={info.author.profileImgUrl} />\n          <ProfileId>{info.author.nickname}</ProfileId>\n        </Profile>\n\n        {info.information.posPlay ? (\n          <>\n            {info.information.videoType === \"mp4\" ||\n            info.information.videoType === \"mov\" ? (\n              <View\n                onMouseOver={mp4play}\n                onMouseLeave={mp4pause}\n                onClick={mp4volume}\n              >\n                <VideoPlay\n                  ref={players}\n                  src={params.src}\n                  muted={mute}\n                  loop\n                  autoPlay\n                  onTimeUpdate={() => {\n                    setCompleted(\n                      (players.current.currentTime / players.current.duration) *\n                        100\n                    );\n                    setProgress(players.current.clientWidth);\n                  }}\n                />\n              </View>\n            ) : (\n              <>\n                <View\n                  onMouseOver={hlsplay}\n                  onMouseLeave={hlspause}\n                  onClick={m3u8volume}\n                >\n                  <VideoPlay\n                    ref={player}\n                    muted={mute}\n                    loop\n                    autoPlay\n                    onTimeUpdate={() => {\n                      setCompleted(\n                        (player.current.currentTime / player.current.duration) *\n                          100\n                      );\n                      setProgress(player.current.clientWidth);\n                    }}\n                  />\n                </View>\n              </>\n            )}\n          </>\n        ) : (\n          <>\n            <View>\n              <Uploading src={uploading} />\n            </View>\n          </>\n        )}\n        <Progress width={progress}>\n          <ProgressBar bgcolor={\"#6a1b9a\"} completed={completed} />\n        </Progress>\n        <LowWrap>\n          <LikeCov onClick={like}>\n            {info.member.isLike ? <HeartFill /> : <HeartEmpty />}\n          </LikeCov>\n          <LikeText>좋아요 +{info.information.likeNum}</LikeText>\n          <Tag>\n            {editOn ? (\n              <>\n                {tags.map((tag, i) => (\n                  <Li key={tag}>\n                    #{tag}\n                    <Libutton\n                      type=\"button\"\n                      onClick={() => {\n                        removeTag(i);\n                      }}\n                    >\n                      <IconCover>\n                        <ClearIcon />\n                      </IconCover>\n                    </Libutton>\n                  </Li>\n                ))}\n              </>\n            ) : (\n              <>\n                {info.information.hashtag.map((p, idx) => {\n                  return (\n                    <Fragment key={idx}>\n                      <Hash id={p} onClick={hash}>\n                        #{p}\n                      </Hash>\n                    </Fragment>\n                  );\n                })}\n              </>\n            )}\n          </Tag>\n        </LowWrap>\n        {editOn ? (\n          <InputTag>\n            <Input\n              type=\"text\"\n              maxLength={10}\n              value={tagType}\n              onKeyDown={InputKeyDown}\n              ref={tagInput}\n              placeholder=\"# 자유롭게 적고 엔터를 눌러주세요.(10자 제한)\"\n              onChange={change}\n            ></Input>\n          </InputTag>\n        ) : (\n          <></>\n        )}\n        <Bottom>\n          {editOn ? (\n            <>\n              <Edit onClick={doEdit}>수정완료</Edit>\n              <Delete onClick={cancelEdit}>수정취소</Delete>\n            </>\n          ) : (\n            <>\n              {info.member.isMembers ? (\n                <>\n                  <Edit onClick={edit}>수정하기</Edit>\n                  <Delete onClick={del}>삭제하기</Delete>\n                </>\n              ) : (\n                <></>\n              )}\n            </>\n          )}\n          <Close onClick={closeModal}>닫기</Close>\n        </Bottom>\n      </Wrap>\n    </React.Fragment>\n  );\n};\n\nconst LikeText = styled.div`\n  color: #8b8888;\n  width: 5rem;\n  user-select: none;\n  display: flex;\n  align-items: center;\n`;\n\nconst Uploading = styled.div`\n  display: flex;\n  height: 20rem;\n  width: 40rem;\n  margin: 0 auto;\n  background-image: url(\"${(props) => props.src}\");\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: center;\n`;\n\nconst Input = styled.input`\n  outline: none;\n  width: 100%;\n  height: 2.5rem;\n  border: 0;\n  border-radius: 5px;\n  display: flex;\n  justify-content: flex-start;\n  /* margin: 0px auto; */\n  padding-left: 0.5rem;\n  padding-right: 0.5rem;\n  font-size: 1rem;\n`;\n\nconst InputTag = styled.div`\n  min-width: 30rem;\n  width: 100%;\n  height: 100%;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  display: inline-flex;\n  flex-wrap: wrap;\n  justify-content: flex-start;\n  margin: 0px auto;\n  padding: 5px;\n  margin-bottom: 1rem;\n`;\n\nconst IconCover = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  & svg {\n    width: 1rem;\n  }\n`;\n\nconst Libutton = styled.div`\n  display: inline-flex;\n  align-items: center;\n  appearance: none;\n  background: #333333;\n  border: none;\n  border-radius: 50%;\n  color: white;\n  cursor: pointer;\n  font-size: 12px;\n  height: 15px;\n  justify-content: center;\n  line-height: 0;\n  margin-left: 8px;\n  padding: 0;\n  width: 15px;\n  outline: 0;\n`;\n\nconst Li = styled.div`\n  cursor: pointer;\n  margin-left: 0.5rem;\n  margin-right: 1rem;\n  font-family: \"AppleSDGothicNeoR\";\n  color: blue;\n  display: flex;\n  align-items: center;\n`;\n\nconst Bottom = styled.div`\n  display: flex;\n  flex-direction: row;\n  justify-content: flex-end;\n`;\n\nconst Edit = styled.button`\n  cursor: pointer;\n  font-family: \"paybooc-Bold\";\n  font-size: 1rem;\n  color: #ffffff;\n  background-color: #2b61e1;\n  box-shadow: 0px 3px 6px #00000029;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  width: 8rem;\n  height: 3rem;\n`;\n\nconst Delete = styled.button`\n  cursor: pointer;\n  font-family: \"paybooc-Bold\";\n  font-size: 1rem;\n  color: #ffffff;\n  background-color: #2b61e1;\n  box-shadow: 0px 3px 6px #00000029;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  width: 8rem;\n  height: 3rem;\n  margin-left: 1rem;\n`;\n\nconst Close = styled.button`\n  cursor: pointer;\n  font-family: \"paybooc-Bold\";\n  font-size: 1rem;\n  color: #ffffff;\n  background-color: #2b61e1;\n  box-shadow: 0px 3px 6px #00000029;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  width: 8rem;\n  height: 3rem;\n  margin-left: 1rem;\n`;\n\nconst Progress = styled.div`\n  margin: 0 auto;\n  width: ${(props) => props.width}px;\n`;\n\nconst VideoPlay = styled.video`\n  display: flex;\n  margin: 0 auto;\n  max-width: 50rem;\n  max-height: 30rem;\n  object-fit: contain;\n\n  @media (max-width: 768px) {\n    max-width: 35rem;\n    max-height: 30rem;\n  }\n\n  @media (max-width: 600px) {\n  }\n  @media (max-width: 540px) {\n    width: 30rem;\n    max-height: 50rem;\n  }\n  @media (max-width: 415px) {\n  }\n`;\n\nconst Hash = styled.div`\n  user-select: none;\n  cursor: pointer;\n  margin-left: 0.5rem;\n  font-family: \"AppleSDGothicNeoR\";\n  color: blue;\n  transition: 0.5s ease-in-out;\n  :hover {\n    transform: scale(1.2);\n  }\n`;\n\nconst Component = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: ${(props) => props.height}px;\n  width: ${(props) => props.width}px;\n  background-color: black;\n  z-index: 60;\n  opacity: 0.4;\n`;\nconst Wrap = styled.div`\n  position: fixed;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  z-index: 70;\n  background-color: white;\n  max-width: 57rem;\n  max-height: 45rem;\n  display: flex;\n  flex-direction: column;\n  margin: 0px auto;\n  box-shadow: 0px 3px 6px #00000029;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  padding: 3rem;\n  z-index: 98;\n\n  @media (max-width: 768px) {\n    max-width: 35rem;\n    max-height: 30rem;\n  }\n\n  @media (max-width: 600px) {\n    max-width: 32rem;\n    max-height: 30rem;\n  }\n  @media (max-width: 540px) {\n    height: ${(props) => props.height}px;\n    width: ${(props) => props.width}px;\n    max-height: ${(props) => props.height}px;\n    max-width: ${(props) => props.width}px;\n  }\n  @media (max-width: 415px) {\n    height: ${(props) => props.height}px;\n    width: ${(props) => props.width}px;\n  }\n`;\n\nconst LowWrap = styled.div`\n  display: flex;\n  flex-direction: row;\n  margin-left: 1rem;\n  margin-top: 1rem;\n  margin-bottom: 2rem;\n`;\n\nconst Profile = styled.div`\n  display: flex;\n  height: 3rem;\n  align-items: center;\n  margin-bottom: 1rem;\n`;\n\nconst ProfileImg = styled.div`\n  --size: 38px;\n  width: var(--size);\n  height: var(--size);\n  border-radius: var(--size);\n  background-position: center;\n  background-image: url(${(props) => props.src});\n  background-color: white;\n  background-size: cover;\n  margin-left: 16px;\n  display: flex;\n`;\n\nconst ProfileId = styled.div`\n  display: flex;\n  font-weight: 600;\n  font-size: 1rem;\n  margin-left: 11px;\n  align-items: center;\n`;\n\nconst View = styled.div`\n  max-width: 50rem;\n  max-height: 30rem;\n  width: auto;\n  height: auto;\n  min-width: 40rem;\n  min-height: 20rem;\n  background-color: #ededed;\n  /* background-color: #ededed; */\n  display: flex;\n  justify-content: center;\n  margin: 0px auto;\n\n  @media (max-width: 768px) {\n    max-width: 30rem;\n    max-height: 30rem;\n    min-width: 30rem;\n  }\n\n  @media (max-width: 600px) {\n    max-width: 28rem;\n    max-height: 30rem;\n    min-width: 28rem;\n  }\n  @media (max-width: 540px) {\n    max-width: 18rem;\n    max-height: 30rem;\n    min-width: 18rem;\n  }\n  @media (max-width: 415px) {\n  }\n`;\n\nconst LikeCov = styled.div`\n  margin-right: 1rem;\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  z-index: 10;\n  & svg {\n    width: 1.5rem;\n  }\n`;\n\nconst Tag = styled.div`\n  font-weight: 700;\n  margin-left: 1rem;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: wrap;\n`;\n\nexport default TrilsDetail;\n"]},"metadata":{},"sourceType":"module"}