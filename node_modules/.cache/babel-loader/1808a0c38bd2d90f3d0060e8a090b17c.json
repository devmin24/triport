{"ast":null,"code":"import _taggedTemplateLiteral from\"/Users/parkminkyung/Desktop/git/triport/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";import _regeneratorRuntime from\"/Users/parkminkyung/Desktop/git/triport/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"/Users/parkminkyung/Desktop/git/triport/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"/Users/parkminkyung/Desktop/git/triport/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/parkminkyung/Desktop/git/triport/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";var _templateObject,_templateObject2,_templateObject3,_templateObject4,_templateObject5,_templateObject6,_templateObject7,_templateObject8,_templateObject9,_templateObject10,_templateObject11,_templateObject12;import React from\"react\";import styled,{keyframes}from\"styled-components\";import{Editor}from\"@toast-ui/react-editor\";import\"codemirror/lib/codemirror.css\";// Editor's Dependency Style\nimport\"@toast-ui/editor/dist/toastui-editor.css\";// Editor's Style\nimport\"tui-color-picker/dist/tui-color-picker.css\";import codeSyntax from\"@toast-ui/editor-plugin-color-syntax\";import\"highlight.js/styles/github.css\";import codeSyntaxHighlight from\"@toast-ui/editor-plugin-code-syntax-highlight\";import{history}from\"redux/configureStore\";import{actionCreators as TrilogActions}from\"redux/modules/trilog\";import{useDispatch,useSelector}from\"react-redux\";import{config}from\"redux/modules/config\";import _ from\"lodash\";import{BoardWriteMap}from\"components/components\";import LoopIcon from\"@material-ui/icons/Loop\";import Swal from\"sweetalert2\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var BoardWrite=function BoardWrite(props){var dispatch=useDispatch();var is_loading=useSelector(function(state){return state.trilog.loading.detail_loading;});// 모든 contents가 로드가 됬나 여부\nvar detail=useSelector(function(state){return state.trilog.detail;});// 상세 게시글 정보 from Redux\nvar id=props.match.params.id;// 상세 게시글 ID\nvar is_edit=id?true:false;// 수정페이지인지 작성페이지인지\nvar data=React.useRef();var _React$useState=React.useState(\"\"),_React$useState2=_slicedToArray(_React$useState,2),title=_React$useState2[0],setTitle=_React$useState2[1];// 제목\nvar _React$useState3=React.useState(\"지도 마커를 클릭하시면 주소가 여기 표시됩니다.\"),_React$useState4=_slicedToArray(_React$useState3,2),address=_React$useState4[0],setAddress=_React$useState4[1];// 주소\nvar _React$useState5=React.useState(\"관악구청\"),_React$useState6=_slicedToArray(_React$useState5,2),keyword=_React$useState6[0],setKeyword=_React$useState6[1];// 지도 검색 키워드\nvar _React$useState7=React.useState([]),_React$useState8=_slicedToArray(_React$useState7,2),imageUrls=_React$useState8[0],setImageUrls=_React$useState8[1];// 사용자가 작성 및 수정시 사용했던 모든 이미지들, 이후 서버에서 사용안한 이미지들 삭제\nvar _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),imgLoading=_React$useState10[0],setImgLoading=_React$useState10[1];// 이미지 로딩 시\nvar handleMap=_.debounce(function(val){setKeyword(val);},500);// 게시글 작성 및 수정\nvar sendData=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var content,filter_imageUrls,filter_images,post;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!(title===\"\")){_context.next=3;break;}Swal.fire({title:\"제목을 입력하세요.\",icon:\"warning\"});return _context.abrupt(\"return\");case 3:content=data.current.getInstance().getMarkdown();if(!(content===\"\")){_context.next=7;break;}Swal.fire({title:\"내용을 입력하세요.\",icon:\"warning\"});return _context.abrupt(\"return\");case 7:filter_imageUrls=imageUrls.filter(function(val){return content.includes(val.imageFilePath);});// 사용안한 이미지 링크들 제거\nif(is_edit){if(detail.information.imageUrlList.length>0){filter_images=detail.information.imageUrlList.filter(function(val){return content.includes(val.imageFilePath);});filter_imageUrls=[].concat(_toConsumableArray(filter_images),_toConsumableArray(filter_imageUrls));}}post={title:title,address:address,description:content,imageUrlList:filter_imageUrls,is_edit:is_edit,id:id};dispatch(TrilogActions.addTrilog(post));setImageUrls([]);case 12:case\"end\":return _context.stop();}}},_callee);}));return function sendData(){return _ref.apply(this,arguments);};}();// Toast UI Editor에서 사용자가 이미지 추가할때\nvar uploadImage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(blob){var file_size,api,access_token,formData,url;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:file_size=blob.size/1024/1024;if(!(file_size>10)){_context2.next=4;break;}// 이미지가 10MB보다 크다면\nSwal.fire({title:\"각 이미지 용량은 최대 10MB 입니다.\",icon:\"warning\"});return _context2.abrupt(\"return\",\"failed\");case 4:api=\"\";if(is_edit){api=\"\".concat(config,\"/api/boards/image/\").concat(id);}else{api=\"\".concat(config,\"/api/boards/image\");}access_token=localStorage.getItem(\"access_token\");formData=new FormData();formData.append(\"imageFile\",blob);setImgLoading(true);_context2.next=12;return fetch(api,{method:\"POST\",headers:{Authorization:\"\".concat(access_token)},body:formData}).then(function(res){return res.json();}).catch(function(error){return console.log(error,\"uploadImage\");});case 12:url=_context2.sent;setImgLoading(false);if(!(url.status===200)){_context2.next=19;break;}setImageUrls(function(prevState){return[].concat(_toConsumableArray(prevState),[{imageFilePath:url.results.imageFilePath}]);});return _context2.abrupt(\"return\",url.results.imageFilePath);case 19:if(url.status===401){Swal.fire({title:url.msg,icon:\"warning\"});}else{Swal.fire({title:url.msg,icon:\"warning\"});}return _context2.abrupt(\"return\",\"failed\");case 21:case\"end\":return _context2.stop();}}},_callee2);}));return function uploadImage(_x){return _ref2.apply(this,arguments);};}();React.useEffect(function(){if(is_edit){dispatch(TrilogActions.getTrilogDetail(id));if(detail.information!==undefined){setAddress(detail.information.address);setTitle(detail.information.title);}}},[]);return/*#__PURE__*/_jsx(WriteContainer,{children:is_loading&&is_edit?/*#__PURE__*/_jsx(_Fragment,{}):/*#__PURE__*/_jsxs(_Fragment,{children:[imgLoading?/*#__PURE__*/_jsxs(ImgLoading,{children:[/*#__PURE__*/_jsx(LoopIcon,{}),/*#__PURE__*/_jsx(\"div\",{children:\"\\u26A1\\uC870\\uAE08\\uB9CC \\uAE30\\uB2E4\\uB824 \\uC8FC\\uC138\\uC694\\u26A1\"})]}):/*#__PURE__*/_jsx(_Fragment,{}),/*#__PURE__*/_jsx(Title,{margin:\"0 0 1.25rem 0\",children:is_edit?/*#__PURE__*/_jsx(\"h2\",{style:{textAlign:\"center\"},children:\"Trilog \\uC218\\uC815\"}):/*#__PURE__*/_jsx(\"h2\",{style:{textAlign:\"center\"},children:\"Trilog \\uC791\\uC131\"})}),/*#__PURE__*/_jsx(Title,{margin:\"0 0 1.25rem 0\",children:/*#__PURE__*/_jsx(\"span\",{children:\"\\uC81C\\uBAA9\"})}),/*#__PURE__*/_jsx(InputContainer,{children:/*#__PURE__*/_jsx(TitleInput,{id:\"title\",type:\"text\",placeholder:\"\\uC81C\\uBAA9\\uC744 \\uC785\\uB825\\uD574\\uC8FC\\uC138\\uC694\",value:title,onChange:function onChange(e){return setTitle(e.target.value);}})}),/*#__PURE__*/_jsx(Title,{margin:\"1.25rem 0 1.25rem 0\",children:/*#__PURE__*/_jsx(\"span\",{children:\"\\uC704\\uCE58\"})}),/*#__PURE__*/_jsxs(InputContainer,{margin:\"0 0 1.5rem 0\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"\\uC5EC\\uD589\\uC8FC\\uC18C : \"}),/*#__PURE__*/_jsx(Address,{children:address})]}),/*#__PURE__*/_jsxs(MapContainer,{children:[/*#__PURE__*/_jsx(MapInput,{type:\"text\",placeholder:\"\\uC608) \\uC7A5\\uC18C/\\uAC00\\uAC8C \\uC774\\uB984 - \\uB0A8\\uC0B0, \\uC11C\\uC6B8\\uC5ED or \\uC8FC\\uC18C - \\uC11C\\uC6B8\\uC2DC \\uAD00\\uC545\\uAD6C \\uAD00\\uC545\\uB85C 145\",onChange:function onChange(e){handleMap(e.target.value);}}),/*#__PURE__*/_jsx(BoardWriteMap,{keyword:keyword,setAddress:setAddress,drag:true})]}),/*#__PURE__*/_jsx(Title,{margin:\"1.25rem 0 1.25rem 0\",children:/*#__PURE__*/_jsx(\"span\",{children:\"\\uB0B4\\uC6A9\"})}),/*#__PURE__*/_jsx(InputContainer,{children:/*#__PURE__*/_jsx(Editor,{previewStyle:\"vertical\",height:\"600px\",initialEditType:\"wysiwyg\",initialValue:is_edit?detail.information.description:\"\",plugins:[codeSyntax,codeSyntaxHighlight],hooks:{addImageBlobHook:function(){var _addImageBlobHook=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(blob,callback){var upload;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return uploadImage(blob);case 2:upload=_context3.sent;if(upload!==\"failed\"){callback(upload,\"alt text\");}return _context3.abrupt(\"return\",false);case 5:case\"end\":return _context3.stop();}}},_callee3);}));function addImageBlobHook(_x2,_x3){return _addImageBlobHook.apply(this,arguments);}return addImageBlobHook;}()},ref:data})}),/*#__PURE__*/_jsxs(ButtonContainer,{children:[/*#__PURE__*/_jsx(ButtonComplete,{type:\"button\",value:is_edit?\"수정완료\":\"작성완료\",onClick:sendData}),/*#__PURE__*/_jsx(ButtonCancel,{type:\"button\",value:\"\\uCDE8\\uC18C\",onClick:function onClick(){history.goBack();}})]})]})});};var WriteContainer=styled.div(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 1280px;\\n  margin: 0 auto;\\n  \\n  @media (max-width: 1270px) {\\n    width: 850px;\\n  }\\n\\n  @media (max-width: 980px) {\\n    width: 700px;\\n  }\\n\\n  @media (max-width: 768px) {\\n    width: 500px;\\n  }\\n\\n  @media (max-width: 600px) {\\n    width: 300px;\\n  }\\n\"])));var spin=keyframes(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\n  100% {\\n      transform: rotate(360deg);\\n  }\\n\"])));var ImgLoading=styled.div(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\n  position: fixed;\\n  left: 50%;\\n  transform: translate(-50%, 0);\\n  z-index: 9999;\\n  width: 100%;\\n  min-height: 80%;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  align-items: center;\\n\\n  & svg {\\n    font-size: 7rem;\\n    fill: rgb(43, 97, 225, 0.8);\\n    animation: \",\" 2s linear infinite;\\n  }\\n\"])),spin);var Title=styled.div(_templateObject4||(_templateObject4=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  font-family: \\\"paybooc-Bold\\\";\\n  font-size: 15px;\\n  \",\";\\n\"])),function(props){return props.margin?\"margin: \".concat(props.margin,\";\"):\"\";});var InputContainer=styled.div(_templateObject5||(_templateObject5=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  \",\";\\n\"])),function(props){return props.margin?\"margin: \".concat(props.margin,\";\"):\"\";});var Address=styled.span(_templateObject6||(_templateObject6=_taggedTemplateLiteral([\"\\n  font-family: \\\"AppleSDGothicNeoB\\\";\\n\"])));var MapContainer=styled.div(_templateObject7||(_templateObject7=_taggedTemplateLiteral([\"\\n  position: relative;\\n  width: 100%;\\n\"])));var MapInput=styled.input(_templateObject8||(_templateObject8=_taggedTemplateLiteral([\"\\n  position: absolute;\\n  z-index: 2;\\n  top: 10px;\\n  left: 10px;\\n  width: 30.938rem;\\n  border: 1px solid rgb(43, 97, 225, 0.6);\\n  border-radius: 5px;\\n  outline: none;\\n  padding: 0.75rem 1.25rem;\\n  box-sizing: border-box;\\n\\n  @media (max-width: 768px) {\\n    width: 15rem;\\n  }\\n\\n  @media (max-width: 600px) {\\n    width: 10rem;\\n  }\\n\"])));var TitleInput=styled.input(_templateObject9||(_templateObject9=_taggedTemplateLiteral([\"\\n  width: 31.563rem;\\n  border: 1px solid rgb(43, 97, 225, 0.6);\\n  border-radius: 5px;\\n  outline: none;\\n  padding: 0.75rem 1.25rem;\\n  box-sizing: border-box;\\n\\n  @media (max-width: 600px) {\\n    width: 15rem;\\n  }\\n\"])));var ButtonContainer=styled.div(_templateObject10||(_templateObject10=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  display: flex;\\n  justify-content: center;\\n  margin: 3.563rem 0 4.2rem 0;\\n\"])));var ButtonComplete=styled.input(_templateObject11||(_templateObject11=_taggedTemplateLiteral([\"\\n  cursor: pointer;\\n  background: #2b61e1 0% 0% no-repeat padding-box;\\n  box-shadow: 0px 3px 6px #00000029;\\n  border: 1px solid #2b61e1;\\n  border-radius: 5px;\\n  width: 20.625rem;\\n  height: 3.063rem;\\n  color: #fff;\\n  outline: none;\\n  margin-right: 6.875rem;\\n  font-family: \\\"paybooc-Bold\\\";\\n  font-size: 15px;\\n\"])));var ButtonCancel=styled.input(_templateObject12||(_templateObject12=_taggedTemplateLiteral([\"\\n  cursor: pointer;\\n  background: #707070 0% 0% no-repeat padding-box;\\n  box-shadow: 0px 3px 6px #00000029;\\n  border: 1px solid #707070;\\n  border-radius: 5px;\\n  width: 20.625rem;\\n  height: 3.063rem;\\n  color: #fff;\\n  outline: none;\\n  font-family: \\\"paybooc-Bold\\\";\\n  font-size: 15px;\\n\"])));export default BoardWrite;","map":{"version":3,"sources":["/Users/parkminkyung/Desktop/git/triport/src/pages/BoardWrite.js"],"names":["React","styled","keyframes","Editor","codeSyntax","codeSyntaxHighlight","history","actionCreators","TrilogActions","useDispatch","useSelector","config","_","BoardWriteMap","LoopIcon","Swal","BoardWrite","props","dispatch","is_loading","state","trilog","loading","detail_loading","detail","id","match","params","is_edit","data","useRef","useState","title","setTitle","address","setAddress","keyword","setKeyword","imageUrls","setImageUrls","imgLoading","setImgLoading","handleMap","debounce","val","sendData","fire","icon","content","current","getInstance","getMarkdown","filter_imageUrls","filter","includes","imageFilePath","information","imageUrlList","length","filter_images","post","description","addTrilog","uploadImage","blob","file_size","size","api","access_token","localStorage","getItem","formData","FormData","append","fetch","method","headers","Authorization","body","then","res","json","catch","error","console","log","url","status","prevState","results","msg","useEffect","getTrilogDetail","undefined","textAlign","e","target","value","addImageBlobHook","callback","upload","goBack","WriteContainer","div","spin","ImgLoading","Title","margin","InputContainer","Address","span","MapContainer","MapInput","input","TitleInput","ButtonContainer","ButtonComplete","ButtonCancel"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport styled, { keyframes } from \"styled-components\";\r\nimport { Editor } from \"@toast-ui/react-editor\";\r\nimport \"codemirror/lib/codemirror.css\"; // Editor's Dependency Style\r\nimport \"@toast-ui/editor/dist/toastui-editor.css\"; // Editor's Style\r\nimport \"tui-color-picker/dist/tui-color-picker.css\";\r\nimport codeSyntax from \"@toast-ui/editor-plugin-color-syntax\";\r\nimport \"highlight.js/styles/github.css\";\r\nimport codeSyntaxHighlight from \"@toast-ui/editor-plugin-code-syntax-highlight\";\r\nimport { history } from \"redux/configureStore\";\r\nimport { actionCreators as TrilogActions } from \"redux/modules/trilog\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { config } from \"redux/modules/config\";\r\nimport _ from \"lodash\";\r\nimport { BoardWriteMap } from \"components/components\";\r\nimport LoopIcon from \"@material-ui/icons/Loop\";\r\nimport Swal from \"sweetalert2\";\r\n\r\nconst BoardWrite = (props) => {\r\n  const dispatch = useDispatch();\r\n  const is_loading = useSelector((state) => state.trilog.loading.detail_loading); // 모든 contents가 로드가 됬나 여부\r\n  const detail = useSelector((state) => state.trilog.detail); // 상세 게시글 정보 from Redux\r\n  const id = props.match.params.id; // 상세 게시글 ID\r\n  const is_edit = id ? true : false; // 수정페이지인지 작성페이지인지\r\n\r\n  const data = React.useRef();\r\n\r\n  const [title, setTitle] = React.useState(\"\"); // 제목\r\n  const [address, setAddress] = React.useState(\"지도 마커를 클릭하시면 주소가 여기 표시됩니다.\"); // 주소\r\n  const [keyword, setKeyword] = React.useState(\"관악구청\"); // 지도 검색 키워드\r\n  const [imageUrls, setImageUrls] = React.useState([]); // 사용자가 작성 및 수정시 사용했던 모든 이미지들, 이후 서버에서 사용안한 이미지들 삭제\r\n  const [imgLoading, setImgLoading] = React.useState(false); // 이미지 로딩 시\r\n\r\n  const handleMap = _.debounce((val) => {\r\n    setKeyword(val);\r\n  }, 500);\r\n\r\n  // 게시글 작성 및 수정\r\n  const sendData = async () => {\r\n    if (title === \"\") {\r\n      Swal.fire({\r\n          title: \"제목을 입력하세요.\",\r\n          icon: \"warning\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    const content = data.current.getInstance().getMarkdown();\r\n\r\n    if (content === \"\") {\r\n      Swal.fire({\r\n          title: \"내용을 입력하세요.\",\r\n          icon: \"warning\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    let filter_imageUrls = imageUrls.filter((val) => content.includes(val.imageFilePath)); // 사용안한 이미지 링크들 제거\r\n\r\n    if(is_edit) {\r\n      if(detail.information.imageUrlList.length > 0) {\r\n        const filter_images = detail.information.imageUrlList.filter((val) => content.includes(val.imageFilePath));\r\n        filter_imageUrls = [...filter_images, ...filter_imageUrls];\r\n      } \r\n    }\r\n\r\n    const post = {\r\n      title: title,\r\n      address: address,\r\n      description: content,\r\n      imageUrlList: filter_imageUrls,\r\n      is_edit: is_edit,\r\n      id: id,\r\n    };\r\n\r\n    dispatch(TrilogActions.addTrilog(post));\r\n    setImageUrls([]);\r\n  };\r\n\r\n  // Toast UI Editor에서 사용자가 이미지 추가할때\r\n  const uploadImage = async (blob) => {\r\n    const file_size = blob.size / 1024 / 1024;\r\n\r\n    if (file_size > 10) {\r\n      // 이미지가 10MB보다 크다면\r\n      Swal.fire({\r\n          title: \"각 이미지 용량은 최대 10MB 입니다.\",\r\n          icon: \"warning\",\r\n      });\r\n      return \"failed\";\r\n    }\r\n\r\n    let api = \"\";\r\n\r\n    if (is_edit) {\r\n      api = `${config}/api/boards/image/${id}`;\r\n    } else {\r\n      api = `${config}/api/boards/image`;\r\n    }\r\n\r\n    const access_token = localStorage.getItem(\"access_token\");\r\n\r\n    const formData = new FormData();\r\n    formData.append(\"imageFile\", blob);\r\n\r\n    setImgLoading(true);\r\n    const url = await fetch(api, {\r\n      method: \"POST\",\r\n      headers: {\r\n        Authorization: `${access_token}`,\r\n      },\r\n      body: formData,\r\n    })\r\n      .then((res) => res.json())\r\n      .catch((error) => console.log(error, \"uploadImage\"));\r\n    setImgLoading(false);\r\n\r\n    if (url.status === 200) {\r\n      setImageUrls((prevState) => [\r\n        ...prevState,\r\n        { imageFilePath: url.results.imageFilePath },\r\n      ]);\r\n      return url.results.imageFilePath;\r\n    } else {\r\n      if (url.status === 401) {\r\n        Swal.fire({\r\n            title: url.msg,\r\n            icon: \"warning\",\r\n        });\r\n      } else {\r\n        Swal.fire({\r\n            title: url.msg,\r\n            icon: \"warning\",\r\n        });\r\n      }\r\n      return \"failed\";\r\n    }\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    if (is_edit) {\r\n      dispatch(TrilogActions.getTrilogDetail(id));\r\n      if (detail.information !== undefined) {\r\n        setAddress(detail.information.address);\r\n        setTitle(detail.information.title);\r\n      }\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <WriteContainer>\r\n      {is_loading && is_edit ? (\r\n        <></>\r\n      ) : (\r\n        <>\r\n          {imgLoading ? (\r\n            <ImgLoading>\r\n              <LoopIcon />\r\n              <div>⚡조금만 기다려 주세요⚡</div>\r\n            </ImgLoading>\r\n          ) : (\r\n            <></>\r\n          )}\r\n          <Title margin=\"0 0 1.25rem 0\">\r\n            {is_edit ? (\r\n              <h2 style={{ textAlign: \"center\" }}>Trilog 수정</h2>\r\n            ) : (\r\n              <h2 style={{ textAlign: \"center\" }}>Trilog 작성</h2>\r\n            )}\r\n          </Title>\r\n          <Title margin=\"0 0 1.25rem 0\">\r\n            <span>제목</span>\r\n          </Title>\r\n          <InputContainer>\r\n            <TitleInput\r\n              id=\"title\"\r\n              type=\"text\"\r\n              placeholder=\"제목을 입력해주세요\"\r\n              value={title}\r\n              onChange={(e) => setTitle(e.target.value)}\r\n            />\r\n          </InputContainer>\r\n          <Title margin=\"1.25rem 0 1.25rem 0\">\r\n            <span>위치</span>\r\n          </Title>\r\n          <InputContainer margin=\"0 0 1.5rem 0\">\r\n            <span>여행주소 : </span>\r\n            <Address>{address}</Address>\r\n          </InputContainer>\r\n          <MapContainer>\r\n            <MapInput\r\n              type=\"text\"\r\n              placeholder=\"예) 장소/가게 이름 - 남산, 서울역 or 주소 - 서울시 관악구 관악로 145\"\r\n              onChange={(e) => {\r\n                handleMap(e.target.value);\r\n              }}\r\n            />\r\n            <BoardWriteMap\r\n              keyword={keyword}\r\n              setAddress={setAddress}\r\n              drag={true}\r\n            />\r\n          </MapContainer>\r\n          <Title margin=\"1.25rem 0 1.25rem 0\">\r\n            <span>내용</span>\r\n          </Title>\r\n          <InputContainer>\r\n            <Editor\r\n              previewStyle=\"vertical\"\r\n              height=\"600px\"\r\n              initialEditType=\"wysiwyg\"\r\n              initialValue={is_edit ? detail.information.description : \"\"}\r\n              plugins={[codeSyntax, codeSyntaxHighlight]}\r\n              hooks={{\r\n                addImageBlobHook: async (blob, callback) => {\r\n                  const upload = await uploadImage(blob);\r\n                  if (upload !== \"failed\") {\r\n                    callback(upload, \"alt text\");\r\n                  }\r\n                  return false;\r\n                },\r\n              }}\r\n              ref={data}\r\n            />\r\n          </InputContainer>\r\n          <ButtonContainer>\r\n            <ButtonComplete\r\n              type=\"button\"\r\n              value={is_edit ? \"수정완료\" : \"작성완료\"}\r\n              onClick={sendData}\r\n            />\r\n            <ButtonCancel\r\n              type=\"button\"\r\n              value=\"취소\"\r\n              onClick={() => {\r\n                history.goBack();\r\n              }}\r\n            />\r\n          </ButtonContainer>\r\n        </>\r\n      )}\r\n    </WriteContainer>\r\n  );\r\n};\r\n\r\nconst WriteContainer = styled.div`\r\n  width: 1280px;\r\n  margin: 0 auto;\r\n  \r\n  @media (max-width: 1270px) {\r\n    width: 850px;\r\n  }\r\n\r\n  @media (max-width: 980px) {\r\n    width: 700px;\r\n  }\r\n\r\n  @media (max-width: 768px) {\r\n    width: 500px;\r\n  }\r\n\r\n  @media (max-width: 600px) {\r\n    width: 300px;\r\n  }\r\n`;\r\n\r\nconst spin = keyframes`\r\n  100% {\r\n      transform: rotate(360deg);\r\n  }\r\n`;\r\n\r\nconst ImgLoading = styled.div`\r\n  position: fixed;\r\n  left: 50%;\r\n  transform: translate(-50%, 0);\r\n  z-index: 9999;\r\n  width: 100%;\r\n  min-height: 80%;\r\n  display: flex;\r\n  flex-direction: column;\r\n  justify-content: center;\r\n  align-items: center;\r\n\r\n  & svg {\r\n    font-size: 7rem;\r\n    fill: rgb(43, 97, 225, 0.8);\r\n    animation: ${spin} 2s linear infinite;\r\n  }\r\n`;\r\n\r\nconst Title = styled.div`\r\n  width: 100%;\r\n  font-family: \"paybooc-Bold\";\r\n  font-size: 15px;\r\n  ${(props) => (props.margin ? `margin: ${props.margin};` : \"\")};\r\n`;\r\n\r\nconst InputContainer = styled.div`\r\n  width: 100%;\r\n  ${(props) => (props.margin ? `margin: ${props.margin};` : \"\")};\r\n`;\r\n\r\nconst Address = styled.span`\r\n  font-family: \"AppleSDGothicNeoB\";\r\n`;\r\n\r\nconst MapContainer = styled.div`\r\n  position: relative;\r\n  width: 100%;\r\n`;\r\n\r\nconst MapInput = styled.input`\r\n  position: absolute;\r\n  z-index: 2;\r\n  top: 10px;\r\n  left: 10px;\r\n  width: 30.938rem;\r\n  border: 1px solid rgb(43, 97, 225, 0.6);\r\n  border-radius: 5px;\r\n  outline: none;\r\n  padding: 0.75rem 1.25rem;\r\n  box-sizing: border-box;\r\n\r\n  @media (max-width: 768px) {\r\n    width: 15rem;\r\n  }\r\n\r\n  @media (max-width: 600px) {\r\n    width: 10rem;\r\n  }\r\n`;\r\n\r\nconst TitleInput = styled.input`\r\n  width: 31.563rem;\r\n  border: 1px solid rgb(43, 97, 225, 0.6);\r\n  border-radius: 5px;\r\n  outline: none;\r\n  padding: 0.75rem 1.25rem;\r\n  box-sizing: border-box;\r\n\r\n  @media (max-width: 600px) {\r\n    width: 15rem;\r\n  }\r\n`;\r\n\r\nconst ButtonContainer = styled.div`\r\n  width: 100%;\r\n  display: flex;\r\n  justify-content: center;\r\n  margin: 3.563rem 0 4.2rem 0;\r\n`;\r\n\r\nconst ButtonComplete = styled.input`\r\n  cursor: pointer;\r\n  background: #2b61e1 0% 0% no-repeat padding-box;\r\n  box-shadow: 0px 3px 6px #00000029;\r\n  border: 1px solid #2b61e1;\r\n  border-radius: 5px;\r\n  width: 20.625rem;\r\n  height: 3.063rem;\r\n  color: #fff;\r\n  outline: none;\r\n  margin-right: 6.875rem;\r\n  font-family: \"paybooc-Bold\";\r\n  font-size: 15px;\r\n`;\r\n\r\nconst ButtonCancel = styled.input`\r\n  cursor: pointer;\r\n  background: #707070 0% 0% no-repeat padding-box;\r\n  box-shadow: 0px 3px 6px #00000029;\r\n  border: 1px solid #707070;\r\n  border-radius: 5px;\r\n  width: 20.625rem;\r\n  height: 3.063rem;\r\n  color: #fff;\r\n  outline: none;\r\n  font-family: \"paybooc-Bold\";\r\n  font-size: 15px;\r\n`;\r\n\r\nexport default BoardWrite;\r\n"]},"metadata":{},"sourceType":"module"}