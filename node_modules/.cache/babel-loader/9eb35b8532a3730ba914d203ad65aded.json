{"ast":null,"code":"var _jsxFileName = \"/Users/parkminkyung/Desktop/git/triport/src/pages/TrilsWrite.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport ClearIcon from \"@material-ui/icons/Clear\";\nimport { useDispatch } from \"react-redux\";\nimport { TrilsActions } from \"redux/modules/trils\";\nimport TrilsUploadPost from \"../media/image/trils_upload_post.png\";\nimport { config } from \"redux/modules/config\";\nimport { logOut } from \"redux/modules/user\";\nimport Spinner from \"shared/Spinner\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst TrilsWrite = props => {\n  _s();\n\n  const {\n    history\n  } = props;\n  const tagInput = useRef(null);\n  const fileInput = useRef();\n  const [tags, setTags] = useState([]);\n  const dispatch = useDispatch();\n  const [vid, setVid] = useState(null);\n  const [tagType, setTagType] = useState(\"\");\n  const [lock, setLock] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const removeTag = i => {\n    const newTags = [...tags];\n    newTags.splice(i, 1);\n    setTags([...newTags]);\n  };\n\n  const InputKeyDown = e => {\n    const val = e.target.value;\n\n    if (e.key === \"Enter\" && val || e.key === \",\" && val || e.key === \" \" && val) {\n      if (tags.length === 10) {\n        alert(\"태그는 최대 10개까지 가능합니다.\");\n        return;\n      }\n\n      if (tags.find(tag => tag.toLowerCase() === val.toLowerCase())) {\n        return;\n      }\n\n      setTagType(\"\");\n      setTags([...tags, val]);\n    } else if (e.key === \"Backspace\" && !val) {\n      removeTag(tags.length - 1);\n    }\n  };\n\n  const post = () => {\n    setLock(true);\n\n    if (vid === undefined || vid == null) {\n      alert(\"영상을 업로드해주세요\");\n      setLock(false);\n      return;\n    }\n\n    if (tags.length === 0) {\n      alert(\"태그를 1개 이상 작성해주세요\");\n      setLock(false);\n      return;\n    }\n\n    setLoading(true);\n    const access_token = localStorage.getItem(\"access_token\");\n    let formData = new FormData();\n    formData.append(\"file\", vid);\n    tags.map((p, idx) => formData.append(\"hashtag\", p));\n    const api = `${config}/api/posts`;\n    const data = {\n      method: \"POST\",\n      headers: {\n        Authorization: `${access_token}`\n      },\n      body: formData\n    };\n    fetch(api, data).then(result => {\n      if (result.status === 401) {\n        localStorage.removeItem(\"access_token\");\n        localStorage.removeItem(\"refresh_token\");\n        localStorage.removeItem(\"userInfo\");\n        dispatch(logOut());\n        setLoading(false);\n        alert(\"로그인 시간이 만료되었습니다. 다시 로그인해주세요.\");\n        history.push(\"/login\");\n      }\n\n      return result.json();\n    }).then(result => {\n      if (result.ok) {\n        setLoading(false);\n        alert(\"정상적으로 작성되었습니다.\");\n        history.replace(\"/\");\n        setLock(false);\n      } else {\n        setLoading(false);\n        alert(result.msg);\n        setLock(false);\n      }\n    }).catch(err => {\n      setLoading(false);\n      setLock(false);\n      alert(\"업로드 중 에러가 발생했습니다.\", err);\n    });\n  };\n\n  const upload = e => {\n    const reader = new FileReader();\n    const file = fileInput.current.files[0];\n\n    if (!file) {\n      return;\n    }\n\n    if (file.size * 9.5367e-7 > 50) {\n      alert(\"용량이 너무 큽니다.(50mb 이하)\");\n      return;\n    }\n\n    reader.onloadstart = e => {\n      setVid(null);\n    };\n\n    reader.readAsDataURL(file);\n\n    reader.onloadend = e => {\n      setVid(file);\n    };\n  };\n\n  const triggerVideo = () => {\n    fileInput.current.click(); // 인풋 클릭한 효과\n  };\n\n  const change = e => {\n    if (e.target.value.length > 8) {\n      e.target.value = e.target.value.substr(0, 8);\n    }\n\n    const curValue = e.target.value; // const regExp = /[\\{\\}\\[\\]\\/?.,;:|\\)*~`!^\\-_+<>@\\#$%&\\\\\\=\\(\\'\\\"\\s]/gi;\n\n    const regExp = /[{}[\\]/?.,;:|)*~`!^\\-_+<>@#$%&\\\\=('\"\\s]/gi;\n    const newValue = curValue.replace(regExp, \"\");\n    setTagType(newValue);\n  };\n\n  const cancel = () => {\n    history.goBack(0);\n  };\n\n  return /*#__PURE__*/_jsxDEV(React.Fragment, {\n    children: [loading ? /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 18\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {}, void 0, false), /*#__PURE__*/_jsxDEV(Wrap, {\n      children: [/*#__PURE__*/_jsxDEV(VideoView, {\n        onClick: triggerVideo,\n        children: [!(vid === null) ? /*#__PURE__*/_jsxDEV(Uploading, {\n          src: TrilsUploadPost\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: \"25px\",\n              userSelect: \"none\"\n            },\n            children: \"\\uC601\\uC0C1\\uC744 \\uC5C5\\uB85C\\uB4DC\\uD574\\uC8FC\\uC138\\uC694.(\\uD074\\uB9AD)\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 153,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: \"15px\",\n              userSelect: \"none\"\n            },\n            children: \"\\uC601\\uC0C1 \\uAE38\\uC774 10\\uCD08 \\uC774\\uD558, \\uD06C\\uAE30 50MB \\uC774\\uD558\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 156,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"file\",\n          accept: \"video/*\",\n          ref: fileInput,\n          onChange: upload,\n          style: {\n            display: \"none\"\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 148,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Text, {\n        children: tags.map((tag, i) => /*#__PURE__*/_jsxDEV(Li, {\n          children: [tag, /*#__PURE__*/_jsxDEV(Libutton, {\n            type: \"button\",\n            onClick: () => {\n              removeTag(i);\n            },\n            children: /*#__PURE__*/_jsxDEV(IconCover, {\n              children: /*#__PURE__*/_jsxDEV(ClearIcon, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 180,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 179,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 173,\n            columnNumber: 15\n          }, this)]\n        }, tag, true, {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Tag, {\n        children: \"\\uD0DC\\uADF8 (\\uCD5C\\uB300 10\\uAC1C)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(InputTag, {\n        children: /*#__PURE__*/_jsxDEV(Input, {\n          type: \"text\",\n          maxLength: 8,\n          value: tagType,\n          onKeyDown: InputKeyDown,\n          ref: tagInput,\n          placeholder: \"# \\uC790\\uC720\\uB86D\\uAC8C \\uC801\\uACE0 \\uC5D4\\uD130\\uB97C \\uB20C\\uB7EC\\uC8FC\\uC138\\uC694.(8\\uC790 \\uC81C\\uD55C)\",\n          onChange: change\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ButtonWrap, {\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        id: \"write\",\n        onClick: post,\n        disabled: lock,\n        children: \"\\uC791\\uC131\\uC644\\uB8CC\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        id: \"cancel\",\n        onClick: cancel,\n        disabled: lock,\n        children: \"\\uCDE8\\uC18C\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 203,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 145,\n    columnNumber: 5\n  }, this);\n};\n\n_s(TrilsWrite, \"uNagVY9t6Mv/ikjMLOSkpZ8g4Nc=\", false, function () {\n  return [useDispatch];\n});\n\n_c = TrilsWrite;\nconst Component = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: ${props => props.height}px;\n  width: ${props => props.width}px;\n  background-color: black;\n  z-index: 60;\n  opacity: 0.4;\n`;\nconst Uploading = styled.div`\n  display: flex;\n  height: 100%;\n  width: 100%;\n  margin: 0 auto;\n  background-image: url(\"${props => props.src}\");\n  background-color: #ededed;\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: center;\n`;\n_c2 = Uploading;\nconst IconCover = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  & svg {\n    width: 1rem;\n  }\n`;\n_c3 = IconCover;\nconst Libutton = styled.div`\n  display: inline-flex;\n  align-items: center;\n  appearance: none;\n  background: #333333;\n  border: none;\n  border-radius: 50%;\n  color: white;\n  cursor: pointer;\n  font-size: 12px;\n  height: 15px;\n  justify-content: center;\n  line-height: 0;\n  margin-left: 8px;\n  padding: 0;\n  width: 15px;\n  outline: 0;\n`;\n_c4 = Libutton;\nconst Li = styled.li`\n  font-family: \"AppleSDGothicNeoR\";\n  align-items: center;\n  background: #40c7c3;\n  border-radius: 5px;\n  color: white;\n  display: flex;\n  font-weight: 300;\n  list-style: none;\n  margin-bottom: 5px;\n  margin-top: 5px;\n  margin-left: 8px;\n  padding: 5px 10px;\n`;\n_c5 = Li;\nconst InputTag = styled.div`\n  user-select: none;\n  width: 37rem;\n  height: auto;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  display: inline-flex;\n  flex-wrap: wrap;\n  justify-content: flex-start;\n  margin: 0px auto;\n  padding: 5px;\n  @media (max-width: 600px) {\n    width: calc(100% - 20px);\n  }\n`;\n_c6 = InputTag;\nconst Wrap = styled.div`\n  font-family: \"paybooc-Bold\";\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n`;\n_c7 = Wrap;\nconst VideoView = styled.div`\n  cursor: pointer;\n  z-index: 5;\n  width: 37rem;\n  height: 28rem;\n  margin: 0px auto;\n  box-shadow: 0px 3px 6px #00000029;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  color: #2b61e1;\n  margin-top: 1rem;\n  @media only screen and (max-width: 630px) {\n    width: calc(100% - 20px);\n    height: 20rem;\n  }\n`;\n_c8 = VideoView;\nconst Text = styled.div`\n  width: 37rem;\n  font-family: \"AppleSDGothicNeoR\";\n  font-size: 15px;\n  display: flex;\n  justify-content: flex-start;\n  margin: 0px auto;\n  margin-top: 1rem;\n  margin-bottom: 2rem;\n  @media (max-width: 600px) {\n    width: calc(100% - 20px);\n  }\n`;\n_c9 = Text;\nconst Tag = styled.div`\n  user-select: none;\n  width: 37rem;\n  color: #2b61e1;\n  display: flex;\n  justify-content: flex-start;\n  margin: 0px auto;\n  margin-bottom: 1rem;\n  @media (max-width: 600px) {\n    width: calc(100% - 20px);\n  }\n`;\n_c10 = Tag;\nconst Input = styled.input`\n  outline: none;\n  width: 35rem;\n  height: 2.5rem;\n  border: 0;\n  border-radius: 5px;\n  display: flex;\n  justify-content: flex-start;\n  /* margin: 0px auto; */\n  padding-left: 0.5rem;\n  padding-right: 0.5rem;\n  font-size: 1rem;\n  @media (max-width: 600px) {\n    width: 100%;\n  }\n`;\n_c11 = Input;\nconst ButtonWrap = styled.div`\n  width: 40rem;\n  margin: 0px auto;\n  margin-top: 2rem;\n  margin-bottom: 2rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  @media only screen and (max-width: 860px) {\n    flex-direction: column;\n    margin-top: 1rem;\n    width: 100%;\n  }\n`;\n_c12 = ButtonWrap;\nconst Button = styled.button`\n  user-select: none;\n  cursor: pointer;\n  font-family: \"paybooc-Bold\";\n  color: #ffffff;\n  font-size: 1rem;\n  width: 15rem;\n  height: 3rem;\n  background-color: ${props => props.ok ? \"#2b61e1\" : \"#707070\"};\n  box-shadow: 0px 3px 6px #00000029;\n  border: 1px solid;\n  border-color: ${props => props.ok ? \"#2b61e1\" : \"#707070\"};\n  border-radius: 5px;\n  @media only screen and (max-width: 860px) {\n    margin: 5px auto;\n  }\n`;\n_c13 = Button;\nexport default TrilsWrite;\n\nvar _c, _c2, _c3, _c4, _c5, _c6, _c7, _c8, _c9, _c10, _c11, _c12, _c13;\n\n$RefreshReg$(_c, \"TrilsWrite\");\n$RefreshReg$(_c2, \"Uploading\");\n$RefreshReg$(_c3, \"IconCover\");\n$RefreshReg$(_c4, \"Libutton\");\n$RefreshReg$(_c5, \"Li\");\n$RefreshReg$(_c6, \"InputTag\");\n$RefreshReg$(_c7, \"Wrap\");\n$RefreshReg$(_c8, \"VideoView\");\n$RefreshReg$(_c9, \"Text\");\n$RefreshReg$(_c10, \"Tag\");\n$RefreshReg$(_c11, \"Input\");\n$RefreshReg$(_c12, \"ButtonWrap\");\n$RefreshReg$(_c13, \"Button\");","map":{"version":3,"sources":["/Users/parkminkyung/Desktop/git/triport/src/pages/TrilsWrite.js"],"names":["React","useRef","useState","styled","ClearIcon","useDispatch","TrilsActions","TrilsUploadPost","config","logOut","Spinner","TrilsWrite","props","history","tagInput","fileInput","tags","setTags","dispatch","vid","setVid","tagType","setTagType","lock","setLock","loading","setLoading","removeTag","i","newTags","splice","InputKeyDown","e","val","target","value","key","length","alert","find","tag","toLowerCase","post","undefined","access_token","localStorage","getItem","formData","FormData","append","map","p","idx","api","data","method","headers","Authorization","body","fetch","then","result","status","removeItem","push","json","ok","replace","msg","catch","err","upload","reader","FileReader","file","current","files","size","onloadstart","readAsDataURL","onloadend","triggerVideo","click","change","substr","curValue","regExp","newValue","cancel","goBack","fontSize","userSelect","display","Component","div","height","width","Uploading","src","IconCover","Libutton","Li","li","InputTag","Wrap","VideoView","Text","Tag","Input","input","ButtonWrap","Button","button"],"mappings":"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AMC,IAAI,GAAGrG,MAAM,CAAC2F,GAAI;AACxB;AACA;AACA;AACA;AACA,CALA;MAAMU,I;AAON,MAAMC,SAAS,GAAGtG,MAAM,CAAC2F,GAAI;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAnBA;MAAMW,S;AAqBN,MAAMC,IAAI,GAAGvG,MAAM,CAAC2F,GAAI;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAZA;MAAMY,I;AAcN,MAAMC,GAAG,GAAGxG,MAAM,CAAC2F,GAAI;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAXA;OAAMa,G;AAaN,MAAMC,KAAK,GAAGzG,MAAM,CAAC0G,KAAM;AAC3B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAfA;OAAMD,K;AAiBN,MAAME,UAAU,GAAG3G,MAAM,CAAC2F,GAAI;AAC9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAbA;OAAMgB,U;AAeN,MAAMC,MAAM,GAAG5G,MAAM,CAAC6G,MAAO;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAuBpG,KAAD,IAAYA,KAAK,CAACsD,EAAN,GAAW,SAAX,GAAuB,SAAW;AACpE;AACA;AACA,kBAAmBtD,KAAD,IAAYA,KAAK,CAACsD,EAAN,GAAW,SAAX,GAAuB,SAAW;AAChE;AACA;AACA;AACA;AACA,CAhBA;OAAM6C,M;AAkBN,eAAepG,UAAf","sourcesContent":["import React, { useRef, useState } from \"react\";\nimport styled from \"styled-components\";\nimport ClearIcon from \"@material-ui/icons/Clear\";\nimport { useDispatch } from \"react-redux\";\nimport { TrilsActions } from \"redux/modules/trils\";\nimport TrilsUploadPost from \"../media/image/trils_upload_post.png\";\nimport { config } from \"redux/modules/config\";\nimport { logOut } from \"redux/modules/user\";\nimport Spinner from \"shared/Spinner\";\n\nconst TrilsWrite = (props) => {\n  const { history } = props;\n  const tagInput = useRef(null);\n  const fileInput = useRef();\n  const [tags, setTags] = useState([]);\n  const dispatch = useDispatch();\n  const [vid, setVid] = useState(null);\n  const [tagType, setTagType] = useState(\"\");\n  const [lock, setLock] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const removeTag = (i) => {\n    const newTags = [...tags];\n    newTags.splice(i, 1);\n    setTags([...newTags]);\n  };\n\n  const InputKeyDown = (e) => {\n    const val = e.target.value;\n    if (\n      (e.key === \"Enter\" && val) ||\n      (e.key === \",\" && val) ||\n      (e.key === \" \" && val)\n    ) {\n      if (tags.length === 10) {\n        alert(\"태그는 최대 10개까지 가능합니다.\");\n        return;\n      }\n      if (tags.find((tag) => tag.toLowerCase() === val.toLowerCase())) {\n        return;\n      }\n      setTagType(\"\");\n      setTags([...tags, val]);\n    } else if (e.key === \"Backspace\" && !val) {\n      removeTag(tags.length - 1);\n    }\n  };\n\n  const post = () => {\n    setLock(true);\n    if (vid === undefined || vid == null) {\n      alert(\"영상을 업로드해주세요\");\n      setLock(false);\n      return;\n    }\n    if (tags.length === 0) {\n      alert(\"태그를 1개 이상 작성해주세요\");\n      setLock(false);\n      return;\n    }\n    setLoading(true);\n    const access_token = localStorage.getItem(\"access_token\");\n    let formData = new FormData();\n    formData.append(\"file\", vid);\n    tags.map((p, idx) => formData.append(\"hashtag\", p));\n    const api = `${config}/api/posts`;\n    const data = {\n      method: \"POST\",\n      headers: {\n        Authorization: `${access_token}`,\n      },\n      body: formData,\n    };\n    fetch(api, data)\n      .then((result) => {\n        if (result.status === 401) {\n          localStorage.removeItem(\"access_token\");\n          localStorage.removeItem(\"refresh_token\");\n          localStorage.removeItem(\"userInfo\");\n          dispatch(logOut());\n          setLoading(false);\n          alert(\"로그인 시간이 만료되었습니다. 다시 로그인해주세요.\");\n          history.push(\"/login\");\n        }\n        return result.json();\n      })\n      .then((result) => {\n        if (result.ok) {\n          setLoading(false);\n          alert(\"정상적으로 작성되었습니다.\");\n          history.replace(\"/\");\n          setLock(false);\n        } else {\n          setLoading(false);\n          alert(result.msg);\n          setLock(false);\n        }\n      })\n      .catch((err) => {\n        setLoading(false);\n        setLock(false);\n        alert(\"업로드 중 에러가 발생했습니다.\", err);\n      });\n  };\n\n  const upload = (e) => {\n    const reader = new FileReader();\n    const file = fileInput.current.files[0];\n    if (!file) {\n      return;\n    }\n    if (file.size * 9.5367e-7 > 50) {\n      alert(\"용량이 너무 큽니다.(50mb 이하)\");\n      return;\n    }\n    reader.onloadstart = (e) => {\n      setVid(null);\n    };\n    reader.readAsDataURL(file);\n    reader.onloadend = (e) => {\n      setVid(file);\n    };\n  };\n\n  const triggerVideo = () => {\n    fileInput.current.click(); // 인풋 클릭한 효과\n  };\n\n  const change = (e) => {\n    if (e.target.value.length > 8) {\n      e.target.value = e.target.value.substr(0, 8);\n    }\n    const curValue = e.target.value;\n    // const regExp = /[\\{\\}\\[\\]\\/?.,;:|\\)*~`!^\\-_+<>@\\#$%&\\\\\\=\\(\\'\\\"\\s]/gi;\n    const regExp = /[{}[\\]/?.,;:|)*~`!^\\-_+<>@#$%&\\\\=('\"\\s]/gi;\n    const newValue = curValue.replace(regExp, \"\");\n    setTagType(newValue);\n  };\n\n  const cancel = () => {\n    history.goBack(0);\n  };\n\n  return (\n    <React.Fragment>\n      {loading ? <Spinner /> : <></>}\n      <Wrap>\n        <VideoView onClick={triggerVideo}>\n          {!(vid === null) ? (\n            <Uploading src={TrilsUploadPost} />\n          ) : (\n            <>\n              <div style={{ fontSize: \"25px\", userSelect: \"none\" }}>\n                영상을 업로드해주세요.(클릭)\n              </div>\n              <div style={{ fontSize: \"15px\", userSelect: \"none\" }}>\n                영상 길이 10초 이하, 크기 50MB 이하\n              </div>\n            </>\n          )}\n          <input\n            type=\"file\"\n            accept=\"video/*\"\n            ref={fileInput}\n            onChange={upload}\n            style={{ display: \"none\" }}\n          />\n        </VideoView>\n        <Text>\n          {tags.map((tag, i) => (\n            <Li key={tag}>\n              {tag}\n              <Libutton\n                type=\"button\"\n                onClick={() => {\n                  removeTag(i);\n                }}\n              >\n                <IconCover>\n                  <ClearIcon />\n                </IconCover>\n              </Libutton>\n            </Li>\n          ))}\n        </Text>\n        <Tag>태그 (최대 10개)</Tag>\n        <InputTag>\n          <Input\n            type=\"text\"\n            maxLength={8}\n            value={tagType}\n            onKeyDown={InputKeyDown}\n            ref={tagInput}\n            placeholder=\"# 자유롭게 적고 엔터를 눌러주세요.(8자 제한)\"\n            onChange={change}\n          ></Input>\n        </InputTag>\n      </Wrap>\n      <ButtonWrap>\n        <Button id=\"write\" onClick={post} disabled={lock}>\n          작성완료\n        </Button>\n        <Button id=\"cancel\" onClick={cancel} disabled={lock}>\n          취소\n        </Button>\n      </ButtonWrap>\n    </React.Fragment>\n  );\n};\n\nconst Component = styled.div`\n  position: fixed;\n  top: 0;\n  left: 0;\n  height: ${(props) => props.height}px;\n  width: ${(props) => props.width}px;\n  background-color: black;\n  z-index: 60;\n  opacity: 0.4;\n`;\n\nconst Uploading = styled.div`\n  display: flex;\n  height: 100%;\n  width: 100%;\n  margin: 0 auto;\n  background-image: url(\"${(props) => props.src}\");\n  background-color: #ededed;\n  background-size: contain;\n  background-repeat: no-repeat;\n  background-position: center;\n`;\n\nconst IconCover = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  & svg {\n    width: 1rem;\n  }\n`;\n\nconst Libutton = styled.div`\n  display: inline-flex;\n  align-items: center;\n  appearance: none;\n  background: #333333;\n  border: none;\n  border-radius: 50%;\n  color: white;\n  cursor: pointer;\n  font-size: 12px;\n  height: 15px;\n  justify-content: center;\n  line-height: 0;\n  margin-left: 8px;\n  padding: 0;\n  width: 15px;\n  outline: 0;\n`;\n\nconst Li = styled.li`\n  font-family: \"AppleSDGothicNeoR\";\n  align-items: center;\n  background: #40c7c3;\n  border-radius: 5px;\n  color: white;\n  display: flex;\n  font-weight: 300;\n  list-style: none;\n  margin-bottom: 5px;\n  margin-top: 5px;\n  margin-left: 8px;\n  padding: 5px 10px;\n`;\n\nconst InputTag = styled.div`\n  user-select: none;\n  width: 37rem;\n  height: auto;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  display: inline-flex;\n  flex-wrap: wrap;\n  justify-content: flex-start;\n  margin: 0px auto;\n  padding: 5px;\n  @media (max-width: 600px) {\n    width: calc(100% - 20px);\n  }\n`;\n\nconst Wrap = styled.div`\n  font-family: \"paybooc-Bold\";\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n`;\n\nconst VideoView = styled.div`\n  cursor: pointer;\n  z-index: 5;\n  width: 37rem;\n  height: 28rem;\n  margin: 0px auto;\n  box-shadow: 0px 3px 6px #00000029;\n  border: 1px solid #2b61e1;\n  border-radius: 5px;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  color: #2b61e1;\n  margin-top: 1rem;\n  @media only screen and (max-width: 630px) {\n    width: calc(100% - 20px);\n    height: 20rem;\n  }\n`;\n\nconst Text = styled.div`\n  width: 37rem;\n  font-family: \"AppleSDGothicNeoR\";\n  font-size: 15px;\n  display: flex;\n  justify-content: flex-start;\n  margin: 0px auto;\n  margin-top: 1rem;\n  margin-bottom: 2rem;\n  @media (max-width: 600px) {\n    width: calc(100% - 20px);\n  }\n`;\n\nconst Tag = styled.div`\n  user-select: none;\n  width: 37rem;\n  color: #2b61e1;\n  display: flex;\n  justify-content: flex-start;\n  margin: 0px auto;\n  margin-bottom: 1rem;\n  @media (max-width: 600px) {\n    width: calc(100% - 20px);\n  }\n`;\n\nconst Input = styled.input`\n  outline: none;\n  width: 35rem;\n  height: 2.5rem;\n  border: 0;\n  border-radius: 5px;\n  display: flex;\n  justify-content: flex-start;\n  /* margin: 0px auto; */\n  padding-left: 0.5rem;\n  padding-right: 0.5rem;\n  font-size: 1rem;\n  @media (max-width: 600px) {\n    width: 100%;\n  }\n`;\n\nconst ButtonWrap = styled.div`\n  width: 40rem;\n  margin: 0px auto;\n  margin-top: 2rem;\n  margin-bottom: 2rem;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  @media only screen and (max-width: 860px) {\n    flex-direction: column;\n    margin-top: 1rem;\n    width: 100%;\n  }\n`;\n\nconst Button = styled.button`\n  user-select: none;\n  cursor: pointer;\n  font-family: \"paybooc-Bold\";\n  color: #ffffff;\n  font-size: 1rem;\n  width: 15rem;\n  height: 3rem;\n  background-color: ${(props) => (props.ok ? \"#2b61e1\" : \"#707070\")};\n  box-shadow: 0px 3px 6px #00000029;\n  border: 1px solid;\n  border-color: ${(props) => (props.ok ? \"#2b61e1\" : \"#707070\")};\n  border-radius: 5px;\n  @media only screen and (max-width: 860px) {\n    margin: 5px auto;\n  }\n`;\n\nexport default TrilsWrite;\n"]},"metadata":{},"sourceType":"module"}